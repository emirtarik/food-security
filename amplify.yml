version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 20
        - nvm use 20
        - node -v
        - npm -v
        - ls -la
        # sanity check for CRA public/index.html
        - '[ -f public/index.html ] || { echo "ERROR public index missing"; exit 1; }'
        - npm ci --no-audit --no-fund
    build:
      commands:
        - CI=false npm run build
  artifacts:
    baseDirectory: build
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .npm/**/*
